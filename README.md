visualstudio上运行

# 已完成部分统计

**√ 代码部分已经全部OK

## 欧顺祥：

修改close，type，rewind和block命令，允许不带文件名参数，

close关闭当前正在操作的文件，

type显示当前正在操作的文件的内容，

rewind将当前正在操作的文件的指针回到开头，

block显示当前正在操作的文件的盘块号；

修改del，copy，type和block命令，使其可以使用统配符*，*

*del*删除当前目录所有内容，

copy * <目标目录>将当前文件夹所有内容复制到子文件夹中，或者加上/，

即copy * /<目标目录>实现复制到上一级目录的文件夹中，

type*按顺序显示当前目录所有文件的内容，block*按顺序显示当前目录所有文件的盘块号。

## 蔡家豪

4.1修改 md 命令（防止目录与文件重名）

一、任务要求概述

参考程序中，md 命令在创建目录时 只检测是否有同名目录，但 未检测是否存在同名文件。因此，若当前目录已有同名文件，程序仍会错误地允许创建同名目录。

本任务要求:若新建目录名称与“已有目录或已有文件”之一重名，则必须输出：

“错误：目录与现有目录或文件重名！”，并拒绝创建目录。

二、关键修改位置

在 MdComd() 函数中：原逻辑：使用 FindFCB() 查找同名目录。修改后：需要同时判断属性为“文件类型”的目录项是否存在。可在同一目录块内遍历所有目录项，当 名字匹配（前10字符一致） 且目录项未被删除时：若属性中 目录位为 0 → 文件；若属性中 目录位为 1 → 目录，任意情况都属于“重名冲突”。

三、测试用例与运行结果

执行dir指令查看当前目录下的文件，发现已经存在boy文件，此时执行md boy视图创建boy文件夹，结果如下：

4.1Result.png

4.1Flow.png

4.2修改命令行预处理程序

一、任务要求概述

原始的 ParseCommand() 函数在处理用户输入的命令行时，仅将空格（' '）识别为命令名与参数之间的分隔符。

这一缺陷导致程序无法正确解析命令与参数之间没有空格的常见指令格式，包括：

命令名后紧跟路径分隔符：如 cd/usr。

命令名后紧跟特殊参数：如 cd..。

参数后紧跟重定向符号：如 type/file>>/path。

本任务要求修改 ParseCommand() 函数，使其能够识别并正确处理上述所有非空格分隔的命令行格式，将命令名、参数、重定向符号（如存在）作为独立的元素存入 comd[[]][][]数组

 二 、关键修改位置 

关键修改位于文件中的 `int ParseCommand(char* p)` 函数，主要涉及参数提取和重定向符号分离的逻辑。修改核心思想：

修改后的代码新增了一个核心判断和拆分逻辑，作用于第一个元素 comd[0]：

特殊字符查找： 新增的 for 循环遍历 comd[0] 内部，查找是否包含特殊分隔符 /、.、> 或 <。

触发拆分： 一旦找到上述特殊字符，随后的 if (comd[0][i] != '\0') 块即被触发执行。

参数分离操作：

代码首先使用 strcpy(comd[1], &comd[0][i])，将特殊分隔符及其后的所有内容复制到 comd[1] 中，作为第一个参数。例如，对于输入 cd..，comd[1] 获得 ..。

接着，使用 comd[0][i] = '\0' 在分隔符处截断 comd[0]，使其仅保留命令名。例如，对于 cd..，comd[0] 最终只保留 cd。

最后，将原有的后续参数（若存在）整体向后移动一位，并增加参数计数 k。

修改效果： 通过这一新增逻辑，程序解决了命令行输入时，命令名与第一个参数之间缺乏空格分隔的问题，实现了对 cd..、dir/usr 等格式的正确解析。

三、测试用例与运行结果

使用cd usr到达usr目录下，使用dir.. 查看上一级文件夹下内容，然后cd..回到上一级，可见修改后可以正确运行要求格式指令

## 张旭
本次实验在原有文件系统的基础上，新增了以下两个主要命令处理函数：

1.  **int MoveComd(int k)**
    -   **功能**：实现文件或子目录的移动（搬家）以及子目录的重命名。
    -   **输入参数**：`k`（参数个数），全局变量 `comd`（存储了源路径和目标路径）。
    -   **返回值**：`1` 表示成功，负数表示各种错误代码。
2.  **int BatchComd(int k)**
    -   **功能**：实现批处理功能，从指定的文本文件中读取一系列命令并自动按顺序执行。
    -   **输入参数**：`k`（参数个数），全局变量 `comd`（存储了批处理文件名）。
    -   **返回值**：`1` 表示执行完毕，负数表示文件打开失败。

## 骆建春

### fc —— 文件比较

- 功能：逐字节比较两个普通文件；全同输出“文件内容相同”；首个差异输出“文件C:/A与文件C:/B在第N字节处不同：x，y”；文件不存在时报错。
- 流程概要：解析两个路径→查找 FCB→读入缓冲区→逐字节比对→根据差异或长度给出结果。
- 快速测试：
  1) 根目录下创建 file1 内容 `12345abcde`，file2 内容 `12345aaaaa`  
     `fc file1 file2` 期望：第 7 字节 b、a 不同。  
  2) `fc file1 file3` 期望：提示 `文件C:/file3不存在。`

### replace —— 文件取代

- 功能：`replace <文件名> <目录名>`，用源文件覆盖目标目录同名文件（源不删除）。目录名缺省为当前目录。
- 规则：源或目标不存在报错；目标为隐藏/系统禁止；目标为只读需询问；源与目标是同一目录项则提示“文件不能自己取代自己。”。
- 流程概要：解析源→解析目标目录→查找同名目标→属性与同一性检查→读源写目标→提示完成。
- 快速测试：
  1) `cd /` 后执行 `replace map_abc usr`，若 `/usr` 无同名，提示“目录usr中没有可取代的同名文件。”  
  2) 在 `/usr` 下执行 `replace /boy`，用根目录 `/boy` 覆盖 `/usr/boy`。  
  3) 在 `/usr` 下执行 `replace boy`，同一目录项，提示“文件不能自己取代自己。”

## 蔡承哲